<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://unpkg.com/htmx.org@1.9.11"></script>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
  <title>Clients</title>
</head>
<body class="p-6">
  <h1 class="text-2xl font-bold mb-2">{% if show_deleted %}Deleted Clients{% else %}Clients{% endif %}</h1>
  <div class="mb-4 flex items-center gap-4">
    {% if show_deleted %}
      <a href="/admin/clients" class="text-blue-600">Back to Clients</a>
      <form method="post" action="/admin/clients/bulk-restore" onsubmit="return confirm('Restore selected clients?');">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        <button type="submit" class="px-3 py-1 bg-green-600 text-white">Bulk Restore</button>
        <input type="hidden" name="bulk" value="1" />
      </form>
      <form method="post" action="/admin/clients/bulk-permanent-delete" onsubmit="return confirm('Delete selected permanently?');">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        <button type="submit" class="px-3 py-1 bg-red-700 text-white">Bulk Delete Permanently</button>
        <input type="hidden" name="bulk" value="1" />
      </form>
    {% else %}
      <a href="/admin/clients/deleted" class="text-blue-600">View Deleted Clients</a>
      <form method="post" action="/admin/clients/bulk-soft-delete" onsubmit="return confirm('Move selected to Trash?');">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        <button type="submit" class="px-3 py-1 bg-red-600 text-white">Bulk Move to Trash</button>
        <input type="hidden" name="bulk" value="1" />
      </form>
    {% endif %}
  </div>
  {% if not show_deleted %}
  <form method="get" class="mb-4 flex items-center gap-2"
        hx-get="/admin/clients" hx-target="#clients-tbody" hx-swap="innerHTML" hx-push-url="false"
        hx-trigger="keyup delay:300ms from:#search, change from:#plan, submit">
    <input id="search" type="text" name="q" value="{{ q }}" placeholder="Search by name" class="border p-1" />
    <select id="plan" name="plan" class="border p-1">
      <option value="" {% if not plan %}selected{% endif %}>All plans</option>
      <option value="starter" {% if plan=='starter' %}selected{% endif %}>starter</option>
      <option value="pro" {% if plan=='pro' %}selected{% endif %}>pro</option>
      <option value="elite" {% if plan=='elite' %}selected{% endif %}>elite</option>
    </select>
    <button type="submit" class="px-3 py-1 bg-blue-600 text-white">Filter</button>
  </form>
  {% endif %}
  <form id="bulk-form" method="post">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
    <table class="min-w-full border">
      <thead>
        <tr>
          <th class="p-2 border"><input type="checkbox" onclick="document.querySelectorAll('input[name=client_ids]').forEach(cb=>cb.checked=this.checked)"></th>
          <th class="p-2 border">Client</th>
          <th class="p-2 border">Plan</th>
          <th class="p-2 border">Cap Used</th>
          <th class="p-2 border">Next Billing</th>
          <th class="p-2 border">Status</th>
          <th class="p-2 border">Actions</th>
        </tr>
      </thead>
      <tbody id="clients-tbody">
        {% include 'clients_body.html' %}
      </tbody>
    </table>
  </form>
</body>
</html>
